version: "2.1"

services:
  php-cli:
    image: $DOCKER_REGISTRY_IMAGE
    volumes:
      - ./:/usr/src/app
    # user: "${UID-www-data}:${GID-www-data}"
    user: root
    entrypoint: bash
    depends_on:
      - nginx
  php-fpm:
    image: $DOCKER_REGISTRY_IMAGE
    user: "${UID-www-data}:${GID-www-data}"
    command: ["php-fpm", "--nodaemonize"]
    volumes:
      - ./:/usr/src/app/
      - ./php-fpm.conf:/etc/php82/php-fpm.conf php-fpm.conf
      - ./www.conf:/etc/php82/php-fpm.d/www.conf
  nginx:
    image: nginx:1.11.10
    platform: linux/amd64
    depends_on:
      - php-fpm
    ports:
      - "8080:8080"
    volumes:
      - ./:/usr/src/app
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
